<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KiCad Mobile Web</title>
<style>
body { margin:0; font-family:sans-serif; background:#111; color:#fff; overflow:hidden; }
#toolbar { display:flex; flex-wrap:wrap; background:#222; padding:5px; }
#toolbar button { margin:2px; padding:5px 10px; background:#444; color:white; border:none; border-radius:4px; }
#toolbar button.active { background:#0a84ff; }
#canvas { border:1px solid #555; touch-action:none; display:block; margin:0; background:#111; cursor:pointer; }
</style>
</head>
<body>

<div id="toolbar">
  <button id="selectBtn" class="active" onclick="setTool('select')">Auswählen</button>
  <button onclick="setTool('component')">Bauteil</button>
  <button onclick="setTool('wire')">Leitung</button>
  <button onclick="undo()">Rückgängig</button>
  <button onclick="toggleGrid()">Gitter</button>
  <button onclick="switchLayer()">Layer wechseln</button>
</div>

<canvas id="canvas" width="1000" height="600"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let tool = 'select';
let elements = [];
let currentWire = null;
let showGrid = true;
let gridSize = 20;
let zoom = 1;
let offsetX = 0;
let offsetY = 0;
let currentLayer = 'Top';

// Bauteile
const components = [
  {type:'Resistor', color:'orange', w:40, h:10},
  {type:'Capacitor', color:'cyan', w:10, h:30},
  {type:'LED', color:'red', w:15, h:15}
];
let selectedComponent = 0;

// Werkzeugsteuerung
function setTool(t){
  tool = t;
  document.querySelectorAll('#toolbar button').forEach(b=>b.classList.remove('active'));
  if(t==='select') document.getElementById('selectBtn').classList.add('active');
}

// Rückgängig
function undo() { elements.pop(); draw(); }

// Gitter ein/aus
function toggleGrid() { showGrid = !showGrid; draw(); }

// Layer wechseln
function switchLayer() {
  currentLayer = currentLayer==='Top'?'Bottom':'Top';
  draw();
}

// Grid-Snap Funktion
function snap(val){ return Math.round(val/gridSize)*gridSize; }

// Transformation für Pan/Zoom
function transformCanvas(x,y){
  return {x:(x - offsetX)/zoom, y:(y - offsetY)/zoom};
}

// Canvas Interaktion
let isDragging = false;
let dragStart = {};
canvas.addEventListener('pointerdown', e=>{
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const pos = transformCanvas(x,y);

  if(tool==='component'){
    const comp = {...components[selectedComponent], x:snap(pos.x), y:snap(pos.y), layer:currentLayer};
    elements.push(comp);
  } else if(tool==='wire'){
    if(!currentWire){
      currentWire = {type:'wire', points:[{x:snap(pos.x), y:snap(pos.y)}], layer:currentLayer};
    } else {
      currentWire.points.push({x:snap(pos.x), y:snap(pos.y)});
      elements.push(currentWire);
      currentWire = null;
    }
  } else if(tool==='select'){
    isDragging = true;
    dragStart = {x:e.clientX, y:e.clientY};
  }

  draw();
});

canvas.addEventListener('pointermove', e=>{
  if(isDragging){
    const dx = e.clientX - dragStart.x;
    const dy = e.clientY - dragStart.y;
    offsetX += dx;
    offsetY += dy;
    dragStart = {x:e.clientX, y:e.clientY};
    draw();
  }
});

canvas.addEventListener('pointerup', e=>{
  isDragging = false;
});

canvas.addEventListener('wheel', e=>{
  const delta = e.deltaY < 0 ? 1.1 : 0.9;
  zoom *= delta;
  draw();
});

// Zeichnen
function draw(){
  ctx.setTransform(zoom,0,0,zoom,offsetX,offsetY);
  ctx.clearRect(-offsetX/zoom,-offsetY/zoom,canvas.width/zoom,canvas.height/zoom);

  // Gitter
  if(showGrid){
    ctx.strokeStyle='#333';
    ctx.lineWidth=1/zoom;
    for(let x=0;x<canvas.width/zoom;x+=gridSize){
      ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height/zoom); ctx.stroke();
    }
    for(let y=0;y<canvas.height/zoom;y+=gridSize){
      ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width/zoom,y); ctx.stroke();
    }
  }

  // Elemente zeichnen
  for(const el of elements){
    if(el.layer!==currentLayer) continue;
    if(el.type==='wire'){
      ctx.strokeStyle='lime';
      ctx.lineWidth=2/zoom;
      ctx.beginPath();
      ctx.moveTo(el.points[0].x, el.points[0].y);
      for(let i=1;i<el.points.length;i++) ctx.lineTo(el.points[i].x, el.points[i].y);
      ctx.stroke();
    } else { // Bauteile
      ctx.fillStyle=el.color;
      ctx.fillRect(el.x-el.w/2, el.y-el.h/2, el.w, el.h);
      ctx.strokeStyle='#fff';
      ctx.lineWidth=1/zoom;
      ctx.strokeRect(el.x-el.w/2, el.y-el.h/2, el.w, el.h);
    }
  }

  // Aktueller Draht
  if(currentWire){
    ctx.strokeStyle='yellow';
    ctx.lineWidth=2/zoom;
    ctx.beginPath();
    ctx.moveTo(currentWire.points[0].x, currentWire.points[0].y);
    if(currentWire.points.length>1){
      for(let i=1;i<currentWire.points.length;i++) ctx.lineTo(currentWire.points[i].x, currentWire.points[i].y);
    }
    ctx.stroke();
  }
}

// Erste Zeichnung
draw();
</script>

</body>
</html>